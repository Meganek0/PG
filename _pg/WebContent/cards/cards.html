<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>카드</title>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<script src="jquery-3.2.1.js"></script>
<script src="jquery-ui-1.12.1.js"></script>
<script src="jquery-ui-touch-punch.js"></script>
</head>

<body>
	<noscript><p>스크립트 켜라</p></noscript>
	<div id="troll">
		<div id="header">
			<div class="at-header-wrapper">
				<a class="at-activity-name">심영</a>
				<a class="at-activity-perm">전체공개</a>
				<a class="at-logo">
					<span class="at-logo-icon"></span>
					<span class="at-logo-text">TROLLO</span>
				</a>
				<a class="at-menubtn" href="#">
					<span class="at-menu-icon"></span>
				</a>
				<div class="at-menu hide">
					<div class="at-menu-header">
						<div class="at-menu-header-button at-back-icon hide"></div>
						<div class="at-menu-header-title">메뉴</div>
						<div class="at-menu-header-button at-close-icon"></div>
					</div>
					<div class="at-menu-content">
						<div class="at-menu-item at-menu-name">
							<div class="at-menu-item-label">활동명 변경</div>
							<input class="at-activity-name-input"/>
							<a class="at-activity-name-button" href="#" style="text-decoration:none; color:white;">버튼</a>
						</div>
						<div class="at-menu-item at-menu-perm">
							<div class="at-menu-item-label">공개상태 변경</div>
							<div class="at-activity-perm-button">전체공개</div>
							<div class="at-activity-perm-button">지원기업공개</div>
							<div class="at-activity-perm-button">비공개</div>
						</div>
						<div class="at-menu-item at-menu-background">
							<div class="at-menu-item-label">배경화면</div>
							<div class="at-background-image">
								<span class="at-background-image-button">사진</span>
								<input type="file" class="at-background-image-input" style="display:none;"/>
							</div>
							<div class="at-background-color">
								<span class="at-background-color-button">단색</span>
								<input type="color" class="at-background-color-input" style="display:none;">
							</div>
						</div>
						<div class="at-menu-item at-menu-board">삭제시 팝업
						<input type="checkbox" class="at-delblock-dialog" checked>활성</div>
						<div class="at-menu-item mtt">아</div>
					</div>
				</div>
			</div>
		</div>
		<div id="content">
			<div id="at-board">
				<div class="at-list-item" style="z-index:100;">테스트테스트박스</div>
				<div class="at-list-item" style="z-index:100;">테스트테스트박스2</div>
				<div class="at-board-list">
					<div class="at-board-list-header">
						<span class="at-list-name">테스트박스</span>
						<div class="at-list-menu at-list-icon"></div>
					</div>
					<div class="at-board-list-content"><div>공간</div></div>
				</div>
			</div>
			<div class="at-board-menulist">
				<div class="at-board-menu at-addblock"><span class="at-addblock-icon"></span></div>
				<div class="at-board-menu at-delblock"><span class="at-delblock-icon"></span></div>
			</div>
		</div>
	</div>
	<div id="modal" class="hide">
		<div class="md-blind"></div>
		<div class="md-dialog">
			<div class="md-dialog-message"></div>
			<div class="md-dialog-items"></div>
		</div>
	</div>
</body>
<script>
	//READY!
	$boardListDraggable = {
		handle: ".at-board-list-header",
		addClasses: false,
		scroll: false,
		classes:{
			"ui-draggable-handle": "at-sanic",
			"ui-draggable-dragging": "at-gottagofast"
		},
		create:function(e,u){$(".ui-draggable-handle").removeClass("ui-draggable-handle")},
		start:function(e,u){$(".ui-draggable-dragging").removeClass("ui-draggable-dragging")},
		stop: function(e,u){
			if($(this).position().top < 0 && $(this).position().left < 0){
				$(this).animate({top:0,left:0},200,"easeOutExpo",function(){})
			}
			else if($(this).position().left < 0){
				$(this).animate({left:0},200,"easeOutExpo",function(){})
			}   
			else if($(this).position().top < 0){
				$(this).animate({top:0},200,"easeOutExpo",function(){})
			}
		} 
	}

	
	$(document).ready(function() {
		$(document).on('dragover drop', function(e) {
		    e.preventDefault();
		    e.stopPropagation();
		});
		
		$(".at-board-list").draggable($boardListDraggable);
	});
	
	///리스트
	//추가블록
	$(".at-addblock").on("click",function(e){
		$newlist = $("<div>")
		.html(
		'<div class="at-board-list-header">'
			+'<span class="at-list-name">테스트박스</span>'
			+'<div class="at-list-menu at-list-icon"></div>'
		+'</div>'
		).append(
			$("<div>").addClass("at-board-list-content").html('<div>공간</div>').droppable({
				addClasses: false,
				accept:".at-list-item",
				drop: function(e,u){$(this).append(u.draggable.css({"left":0,"top":0}));}
			})
		)
		.addClass("at-board-list")
		.css({
			left: e.pageX,
			top: e.pageY-30,
			position: "absolute"
		}).draggable($boardListDraggable);
		
		$("#at-board").append($newlist);
		
		$newlist.animate({
			left: Math.floor(Math.random() * ($("#content").prop("scrollWidth")-$newlist.width())),
			top: Math.floor(Math.random() * ($("#content").prop("scrollHeight")-$newlist.height()))
		},400,"easeOutExpo");
	})
	
	//삭제블록
	$(".at-delblock").droppable({
		addClasses: false,
		accept: ".at-board-list, .at-list-item",
		over: function(e,u){u.draggable.addClass("faster")},
		out: function(e,u){u.draggable.removeClass("faster")},
		drop: function(e,u){
			if($(".at-delblock-dialog")[0].checked){
				modal("목을 칠까요?",function(){
					u.draggable.remove();
				});
				return;
			}
			u.draggable.remove();
		}
	})
	
	//아이템 추가
	$(".at-list-item").draggable();
	$("#at-board").on('drop',".at-board-list-content",function(e){
		e.preventDefault();
		e.stopPropagation();
		if(e.originalEvent.dataTransfer){
			console.dir(e.originalEvent.dataTransfer.files);
			$(this).append(
				$("<div>").addClass("at-list-item")
				.text(e.originalEvent.dataTransfer.files[0].name)
				.draggable()
			);
		}
	});
	$(".at-board-list-content").droppable({
		addClasses: false,
		accept:".at-list-item",
		drop: function(e,u){
			console.log("반응")
			$(this).append(u.draggable.css({"left":0,"top":0}));
		}
	})
	
	///메뉴
	$(".at-menubtn").on("click", function(){
		$(".at-menu").removeClass("hide",200,"linear")
		$(".at-menubtn").addClass("hide")
	})
	$(".at-menu-header-button.at-close-icon").on("click", function(){
		$(".at-menu").addClass("hide",200,"linear")
		$(".at-menubtn").removeClass("hide",200)
	})
	$(".at-menu-header-button.at-back-icon").on("click", function(){
		$(".at-menu-header-title").text("[메뉴]")
		$(this).addClass("hide",200)
	})
	$(".at-menu").on("click",".at-background-image-button", function(){
		$(".at-background-image-input").trigger("click");
	})
	$(".at-menu").on("change",".at-background-image-input", function(){
		let file = this.files[0]
		if(file){
			if(file.type.startsWith("image")){
				
				var reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = function () {
					$("html").css({
						"background":"url("+reader.result+")",
						"background-size":"cover"
					});
				};
				reader.onerror = function (error) {console.log("오류:", error);};
			}
		}
	})
	$(".at-menu").on("click",".at-background-color-button", function(){
		$(".at-background-color-input").trigger("click");
	})
	$(".at-menu").on("change",".at-background-color-input",function(){
		$("html").css({
			"background":$(this).val(),
			"background-size":"cover"
		});
	});
	
	$(".at-menu").on("click",".at-activity-name-button", function(){
		$(".at-activity-name").text($(".at-activity-name-input").val());
	});
	$(".at-menu").on("click",".at-activity-perm-button", function(){
		$(".at-activity-perm").text($(this).text());
	});
	
	$(".at-menu").on("click",".mtt",function(){
		$(".at-menu-header-button.at-back-icon").toggleClass("hide",200)
	});
	
	///모달
	var modalFunc = function(){return;};
	modal = function(msg,func = function(){return;}){
		//메세지
		$(".md-dialog-message").text(msg);
		//아이템
		$(".md-dialog-items").html(
			'<a href="#" class="md-dialog-item md-dialog-yes">그래</a>'+
			'<a href="#" class="md-dialog-item md-dialog-no">아니</a>'
		);
		//함수
		modalFunc = func;
		$("#modal").removeClass("hide");
	}
	$("#modal").on("click",".md-dialog-item",function(){$("#modal").addClass("hide");});
	$("#modal").on("click",".md-dialog-yes",function(){modalFunc();});
	
</script>
</html>